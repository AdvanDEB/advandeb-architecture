@startuml
' Package diagram for advandeb-knowledge-builder (Toolkit/Package)

!pragma layout smetana
scale max 1920 width

package "advandeb-knowledge-builder\n(Python Package / Toolkit)" as KB_PKG {
  
  package "ingestion" {
    [document_processor.py]
    [pdf_extractor.py]
    [metadata_handler.py]
    [batch_ingestion.py]
  }
  
  package "extraction" {
    [fact_extractor.py]
    [entity_recognizer.py]
    [fact_validator.py]
    [source_attribution.py]
  }
  
  package "stylization" {
    [fact_aggregator.py]
    [stylized_fact_generator.py]
    [evidence_linker.py]
  }
  
  package "graph" {
    [node_manager.py]
    [edge_manager.py]
    [graph_builder.py]
    [graph_query.py]
    [traversal.py]
  }
  
  package "agents" {
    [agent_framework.py]
    [ollama_client.py]
    [tool_registry.py]
    [rag_implementation.py]
  }
  
  package "review" {
    [review_queue.py]
    [approval_logic.py]
    [status_tracker.py]
  }
  
  package "database" {
    [mongo_client.py]
    [collections.py]
    [queries.py]
  }
  
  package "Public API" {
    [__init__.py]
    note right
      Public functions exported:
      - ingest_document()
      - extract_facts()
      - generate_stylized_facts()
      - build_knowledge_graph()
      - query_graph()
      - run_agent_workflow()
      - submit_for_review()
    end note
  }
}

database "MongoDB" as Mongo {
  [facts collection]
  [stylized_facts collection]
  [documents collection]
  [knowledge_graphs collection]
  [reviews collection]
}

node "Ollama LLM Host" as Ollama

actor "Modeling Assistant\n(imports KB)" as MA
actor "Batch Processing Scripts\n(can also use KB)" as BatchScript
actor "MCP Server\n(wraps KB tools)" as MCP

' Usage patterns
MA --> KB_PKG : import advandeb_kb\nCall functions
BatchScript --> KB_PKG : Standalone usage\nfor batch operations
MCP --> KB_PKG : Wraps as\nMCP tools

' KB package dependencies
KB_PKG --> Mongo : Read/write knowledge data
KB_PKG --> Ollama : Agent workflows,\nLLM-based extraction

note top of KB_PKG
  **Knowledge Builder as Toolkit**
  
  No UI - pure Python package
  Provides reusable operations
  Can be imported and used by:
  • Modeling Assistant (main use)
  • Batch processing scripts
  • MCP server (wraps as tools)
  • Any Python application
  
  Separate repo due to complexity
  Independent versioning
end note

note bottom of Mongo
  KB package handles all
  knowledge-related collections
  
  MA backend calls KB functions
  which then interact with MongoDB
end note

@enduml
