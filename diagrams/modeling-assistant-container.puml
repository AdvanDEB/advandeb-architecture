@startuml
' Container diagram for AdvanDEB Modeling Assistant (Main Platform GUI)

!pragma layout smetana
scale max 1920 width

actor "Users\n(All Roles)" as Users

node "AdvanDEB Modeling Assistant\n(Main Platform GUI)" as MA {
  node "Frontend (Vue 3)" as MA_FE {
    package "Views" {
      [Login View]
      [Home View]
      [Chat Interface]
      [Document Ingestion]
      [Fact Browser]
      [Knowledge Graph View]
      [Scenario Builder]
      [Model View]
      [Admin Dashboard]
      [Review Queue]
      [API Key Management]
    }
    
    package "State Management" {
      [Auth Store]
      [Knowledge Store]
      [Modeling Store]
      [api.js + interceptors]
    }
  }

  node "Backend (FastAPI)" as MA_BE {
    package "Authentication" {
      [Google OAuth Integration]
      [JWT Manager]
      [API Key Validator]
      [Auth Middleware]
      [Permission Checker]
    }
    
    package "API Routers" {
      [auth.py]
      [users.py]
      [documents.py]
      [facts.py]
      [knowledge_graph.py]
      [chat.py]
      [scenarios.py]
      [models.py]
      [reviews.py]
      [api_keys.py]
    }

    package "Services" {
      [UserService]
      [DocumentService]
      [FactService]
      [GraphService]
      [ChatService]
      [ScenarioService]
      [ModelService]
      [ReviewService]
      [AuditService]
    }

    package "KB Package Integration" {
      [advandeb_kb import]
      note right
        Imports KB toolkit:
        - ingest_document()
        - extract_facts()
        - build_graph()
        - generate_stylized_facts()
      end note
    }

    package "Database" {
      [Mongo Client (Motor)]
      [Collections: users, api_keys,\nfacts, stylized_facts, documents,\ngraphs, scenarios, models,\naudit_logs, reviews]
    }
  }
}

cloud "Google OAuth 2.0" as GoogleAuth
database "MongoDB\n(Platform Database)" as Mongo
node "advandeb-MCP\n(Tool Server)" as MCP
node "Ollama LLM Host" as Ollama
package "advandeb-knowledge-builder\n(Python Package)" as KB_PKG {
  [ingestion module]
  [extraction module]
  [stylization module]
  [graph module]
  [agents module]
  [review module]
}

' User flows
Users --> MA_FE : Access all features\n(knowledge + modeling)
MA_FE --> GoogleAuth : OAuth login

' Frontend to backend
MA_FE --> MA_BE : HTTP /api/*\n(JWT token)

' Auth flow
MA_BE --> GoogleAuth : Validate OAuth tokens
MA_BE --> Mongo : Users, roles, permissions,\nall platform data

' KB package usage
MA_BE --> KB_PKG : Import and call\nknowledge operations

' MCP integration
MA_BE --> MCP : Agent features\n(chat, intelligent tools)
MCP --> KB_PKG : Wraps KB operations\nas MCP tools
MCP --> Ollama : LLM inference

' KB package to Ollama
KB_PKG --> Ollama : Agent workflows

note right of MA
  **Main Platform GUI**
  Single entry point for all users
  
  Features based on role:
  • Administrator: Full access
  • Curator: Knowledge + modeling
  • Explorer: Read-only
  
  Integrates:
  • KB as imported package
  • MCP for agent features
end note

note bottom of KB_PKG
  **Knowledge Builder Toolkit**
  Python package (no UI)
  Imported by MA backend
  
  Can also be used independently
  for batch processing
end note

@enduml
